<!DOCTYPE html>
<html>

<head>
    <title>Check HDCP versions</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <style>
        html,
        body {
            padding: 0;
            margin: 0;
            border: 0;
            background: black;
            color: white;
            font-family: Arial, sans-serif;
            font-size: 16px;
        }

        a:link,
        a:visited,
        a:hover,
        a:active {
            color: lightblue;
        }

        .page {
            margin: 30px;
        }

        h1 {
            margin: 1em 0 .3em 0;
            padding: 0;
            font-size: 25px;
            font-weight: bold;
        }

        h2 {
            margin: 1em 0 .3em 0;
            padding: 0;
            font-size: 20px;
            font-weight: bold;
        }

        ul {
            margin: 0;
            padding: 0;
        }

        li {
            margin: 0.5em 0 0 1em;
            padding: 0;
        }

        .keysystem {
            margin-top: 10px;
            line-height: 1.7em;
        }

        .keysystem-label {
            font-weight: bold;
        }

        .no-support {
            font-weight: bold;
            color: red;
            display: none;
        }

        .drm-key-systems {
            display: none;
        }
    </style>
</head>

<body>
    <div class="page">
        <h1>Check HDCP support in your browser</h1>

        <div class="no-support">❌ Your browser does not support HDCP version detection.</div>
        <div class="drm-key-systems">
            <h2>DRM key systems</h2>
            <ul class="keysystems">
                <li class="keysystem">
                    <div class="keysystem-label">com.widevine.alpha</div>
                    <div class="keysytem-result" id="widevine-result"></div>
                </li>
                <li class="keysystem">
                    <div class="keysystem-label">com.microsoft.playready.recommendation</div>
                    <div class="keysytem-result" id="playready-result"></div>
                </li>
            </ul>
        </div>

        <h2>Links</h2>
        <ul>
            <li>
                <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/API/MediaKeys/getStatusForPolicy#browser_compatibility">MDN: browser compatibility</a>
            </li>
            <li>
                <a target="_blank" href="https://en.wikipedia.org/wiki/High-bandwidth_Digital_Content_Protection">Wikipedia: HDCP</a>
            </li>
            <li>
                <a target="_blank" href="https://www.digital-cp.com/hdcp-specifications">HDCP Specifications</a>
            </li>
        </ul>
    </div>
    <script type="module">
        import { canDetectHdcpVersion, checkAllHdcpVersions } from './dist/index.esm.js';

        function prepareResult(data) {
            const html = [];
            data.forEach((item) => {
                let line = 'HDCP ' + item.version + ': ' + item.status;
                if (item.status === 'usable') {
                    line = '<b>' + line + ' ✅</b>';
                }

                html.push(line);
            });

            return html.join('<br/>');
        }

        function showElement(elem) {
            if (elem) {
                elem.style.display = 'block';
            }
        }

        function detectHdcpVersion() {
            if (!canDetectHdcpVersion()) {
                const errorElement = document.querySelector('.no-support');
                showElement(errorElement);
                return;
            }

            const drmKeySystemsElement = document.querySelector('.drm-key-systems');
            showElement(drmKeySystemsElement);

            [
                {
                    keySystem: 'com.widevine.alpha',
                    elem: document.querySelector('#widevine-result')
                },
                {
                    keySystem: 'com.microsoft.playready.recommendation',
                    elem: document.querySelector('#playready-result')
                },
            ].forEach(item => {
                checkAllHdcpVersions(item.keySystem)
                    .then(result => {
                        item.elem.innerHTML = prepareResult(result);
                        console.log(result);
                    })
                    .catch(error => {
                        item.elem.innerText = '⚠️ ' + error;
                        console.error(error);
                    });
            });
        }

        detectHdcpVersion();
    </script>
</body>

</html>
